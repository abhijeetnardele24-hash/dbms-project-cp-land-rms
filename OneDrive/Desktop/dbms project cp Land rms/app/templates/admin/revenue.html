{% extends "base.html" %}

{% block title %}Revenue Report - Admin{% endblock %}

{% block extra_css %}
<style>
    .stat-card {
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .stat-card::after {
        content: '\f078';
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        position: absolute;
        right: 15px;
        top: 15px;
        font-size: 0.8rem;
        opacity: 0.6;
        transition: transform 0.3s;
    }
    .stat-card.expanded::after {
        transform: rotate(180deg);
    }
    .stat-details {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid rgba(255,255,255,0.3);
    }
    .stat-card.expanded .stat-details {
        max-height: 500px;
    }
    .detail-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        font-size: 0.9rem;
        border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    .detail-item:last-child {
        border-bottom: none;
    }
    .stat-value {
        font-size: 2rem;
        font-weight: bold;
        margin: 10px 0;
    }
    .stat-label {
        color: #6c757d;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    .chart-container {
        position: relative;
        height: 400px;
        margin-bottom: 30px;
    }
    .growth-positive {
        color: #28a745;
    }
    .growth-negative {
        color: #dc3545;
    }
    .table-responsive {
        margin-top: 20px;
    }
    .filter-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 30px;
    }
    .export-btn {
        margin-left: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="fas fa-chart-line"></i> Revenue Report & Analytics</h1>
        <div>
            <button class="btn btn-success export-btn" onclick="exportToExcel()">
                <i class="fas fa-file-excel"></i> Export to Excel
            </button>
            <button class="btn btn-danger export-btn" onclick="exportToPDF()">
                <i class="fas fa-file-pdf"></i> Export to PDF
            </button>
            <button class="btn btn-info export-btn" onclick="window.print()">
                <i class="fas fa-print"></i> Print Report
            </button>
        </div>
    </div>

    <!-- Date Filter Section -->
    <div class="filter-section">
        <form method="GET" action="{{ url_for('admin.revenue') }}" class="row g-3">
            <div class="col-md-4">
                <label for="start_date" class="form-label">Start Date</label>
                <input type="date" class="form-control" id="start_date" name="start_date" 
                       value="{{ start_date.strftime('%Y-%m-%d') if start_date else '' }}">
            </div>
            <div class="col-md-4">
                <label for="end_date" class="form-label">End Date</label>
                <input type="date" class="form-control" id="end_date" name="end_date" 
                       value="{{ end_date.strftime('%Y-%m-%d') if end_date else '' }}">
            </div>
            <div class="col-md-4 d-flex align-items-end">
                <button type="submit" class="btn btn-primary me-2">
                    <i class="fas fa-filter"></i> Apply Filter
                </button>
                <a href="{{ url_for('admin.revenue') }}" class="btn btn-secondary">
                    <i class="fas fa-redo"></i> Reset
                </a>
            </div>
        </form>
    </div>

    <!-- Summary Statistics -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="stat-card bg-success text-white" onclick="toggleDetails(this)">
                <div class="stat-label">Total Revenue</div>
                <div class="stat-value">₹{{ "{:,.2f}".format(total_revenue) }}</div>
                <div><small>Completed Payments</small></div>
                <div class="stat-details">
                    {% if revenue_by_type %}
                        {% for item in revenue_by_type %}
                        <div class="detail-item">
                            <span>{{ item[0]|title|replace('_', ' ') }}:</span>
                            <span><strong>₹{{ "{:,.2f}".format(item[1]) }}</strong> ({{ item[2] }} txns)</span>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="detail-item">
                            <span>No data available</span>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card bg-warning text-white" onclick="toggleDetails(this)">
                <div class="stat-label">Pending Revenue</div>
                <div class="stat-value">₹{{ "{:,.2f}".format(pending_revenue) }}</div>
                <div><small>Awaiting Payment</small></div>
                <div class="stat-details">
                    <div class="detail-item">
                        <span>Failed Payments:</span>
                        <span><strong>₹{{ "{:,.2f}".format(failed_revenue or 0) }}</strong></span>
                    </div>
                    <div class="detail-item">
                        <span>Status:</span>
                        <span><strong>Pending Collection</strong></span>
                    </div>
                    <div class="detail-item">
                        <span>Collection Rate:</span>
                        <span><strong>{{ "{:.1f}".format((total_revenue / (total_revenue + pending_revenue) * 100) if (total_revenue + pending_revenue) > 0 else 0) }}%</strong></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card bg-info text-white" onclick="toggleDetails(this)">
                <div class="stat-label">Total Transactions</div>
                <div class="stat-value">{{ total_transactions }}</div>
                <div><small>Avg: ₹{{ "{:,.2f}".format(avg_transaction) }}</small></div>
                <div class="stat-details">
                    {% if revenue_by_method %}
                        <div class="detail-item">
                            <span>Payment Methods:</span>
                            <span><strong>{{ revenue_by_method|length }} types</strong></span>
                        </div>
                        {% for method in revenue_by_method[:3] %}
                        <div class="detail-item">
                            <span>{{ method[0]|title }}:</span>
                            <span><strong>{{ method[2] }} txns</strong></span>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="detail-item">
                            <span>No transaction data</span>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card bg-primary text-white" onclick="toggleDetails(this)">
                <div class="stat-label">Growth Rate</div>
                <div class="stat-value {{ 'growth-positive' if growth_rate >= 0 else 'growth-negative' }}">
                    {{ "{:+.1f}".format(growth_rate) }}%
                </div>
                <div><small>vs Previous Period</small></div>
                <div class="stat-details">
                    <div class="detail-item">
                        <span>Current Period:</span>
                        <span><strong>₹{{ "{:,.2f}".format(total_revenue) }}</strong></span>
                    </div>
                    <div class="detail-item">
                        <span>Previous Period:</span>
                        <span><strong>₹{{ "{:,.2f}".format(previous_period_revenue|default(0)) }}</strong></span>
                    </div>
                    <div class="detail-item">
                        <span>Difference:</span>
                        <span><strong>{{ "+" if growth_rate >= 0 else "" }}₹{{ "{:,.2f}".format(total_revenue - (previous_period_revenue|default(0))) }}</strong></span>
                    </div>
                    {% if monthly_revenue and monthly_revenue|length > 0 %}
                    <div class="detail-item">
                        <span>Best Month:</span>
                        <span><strong>{{ monthly_revenue[-1][0] }}</strong></span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row 1 -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Monthly Revenue Trend</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="monthlyRevenueChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-line"></i> Daily Revenue (Last 30 Days)</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="dailyRevenueChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row 2 -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-pie"></i> Revenue by Payment Type</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="revenueByTypeChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-pie"></i> Revenue by Payment Method</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="revenueByMethodChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Revenue by District -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0"><i class="fas fa-map-marked-alt"></i> Revenue by District</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="revenueByDistrictChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Revenue Properties -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-building"></i> Top 10 Revenue-Generating Properties</h5>
                    <span class="badge bg-light text-dark">{{ total_properties_count }} Total Properties</span>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>ULPIN</th>
                                    <th>District</th>
                                    <th>Locality</th>
                                    <th>Total Revenue</th>
                                    <th>Transactions</th>
                                    <th>Avg Transaction</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for property in top_properties %}
                                <tr>
                                    <td>{{ loop.index }}</td>
                                    <td>
                                        <a href="{{ url_for('admin.property_detail', property_id=property[0]) }}" class="text-primary fw-bold" style="text-decoration: none;">
                                            <i class="fas fa-search"></i> {{ property[1] }}
                                        </a>
                                    </td>
                                    <td>{{ property[2] or 'N/A' }}</td>
                                    <td>{{ property[3] or 'N/A' }}</td>
                                    <td class="text-success"><strong>₹{{ "{:,.2f}".format(property[4]) }}</strong></td>
                                    <td><span class="badge bg-info">{{ property[5] }}</span></td>
                                    <td>₹{{ "{:,.2f}".format(property[4] / property[5]) }}</td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="7" class="text-center text-muted">No data available</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% if all_properties and all_properties|length > 10 %}
                    <div class="text-center mt-3">
                        <button class="btn btn-outline-primary" onclick="toggleAllProperties()" id="viewAllBtn">
                            <i class="fas fa-list"></i> View All {{ total_properties_count }} Properties
                        </button>
                    </div>
                    <div id="allPropertiesSection" style="display: none; margin-top: 20px;">
                        <hr>
                        <h6 class="mb-3"><i class="fas fa-list-ul"></i> All Revenue-Generating Properties</h6>
                        <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
                            <table class="table table-sm table-striped">
                                <thead class="sticky-top bg-light">
                                    <tr>
                                        <th>#</th>
                                        <th>ULPIN</th>
                                        <th>Type</th>
                                        <th>District</th>
                                        <th>Locality</th>
                                        <th>Total Revenue</th>
                                        <th>Transactions</th>
                                        <th>Avg</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for property in all_properties %}
                                    <tr>
                                        <td>{{ loop.index }}</td>
                                        <td>
                                            <small>
                                                <a href="{{ url_for('admin.property_detail', property_id=property[0]) }}" class="text-primary" style="text-decoration: none;">
                                                    <i class="fas fa-search"></i> <strong>{{ property[1] }}</strong>
                                                </a>
                                            </small>
                                        </td>
                                        <td><small>{{ property[4] or 'N/A' }}</small></td>
                                        <td><small>{{ property[2] or 'N/A' }}</small></td>
                                        <td><small>{{ property[3] or 'N/A' }}</small></td>
                                        <td class="text-success"><small><strong>₹{{ "{:,.2f}".format(property[5]) }}</strong></small></td>
                                        <td><small><span class="badge bg-info" style="font-size: 0.7rem;">{{ property[6] }}</span></small></td>
                                        <td><small>₹{{ "{:,.2f}".format(property[5] / property[6]) }}</small></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Revenue Breakdown Tables -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-list"></i> Revenue by Payment Type</h5>
                </div>
                <div class="card-body">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Payment Type</th>
                                <th>Transactions</th>
                                <th>Total Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in revenue_by_type %}
                            <tr>
                                <td><span class="badge bg-primary">{{ item[0] or 'N/A' }}</span></td>
                                <td>{{ item[2] }}</td>
                                <td class="text-success"><strong>₹{{ "{:,.2f}".format(item[1]) }}</strong></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-credit-card"></i> Revenue by Payment Method</h5>
                </div>
                <div class="card-body">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Payment Method</th>
                                <th>Transactions</th>
                                <th>Total Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in revenue_by_method %}
                            <tr>
                                <td><span class="badge bg-secondary">{{ item[0] or 'N/A' }}</span></td>
                                <td>{{ item[2] }}</td>
                                <td class="text-success"><strong>₹{{ "{:,.2f}".format(item[1]) }}</strong></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Large Transactions -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0"><i class="fas fa-dollar-sign"></i> Recent Large Transactions (₹10,000+)</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Payment Reference</th>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Method</th>
                                    <th>Amount</th>
                                    <th>Receipt</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for payment in recent_large_transactions %}
                                <tr>
                                    <td><strong>{{ payment.payment_reference }}</strong></td>
                                    <td>{{ payment.payment_date.strftime('%d-%m-%Y') if payment.payment_date else 'N/A' }}</td>
                                    <td><span class="badge bg-primary">{{ payment.payment_type }}</span></td>
                                    <td><span class="badge bg-info">{{ payment.payment_method }}</span></td>
                                    <td class="text-success"><strong>₹{{ "{:,.2f}".format(payment.amount) }}</strong></td>
                                    <td><small>{{ payment.receipt_number or 'N/A' }}</small></td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="6" class="text-center text-muted">No large transactions found</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Coming Soon Modal -->
    <div class="modal fade" id="comingSoonModal" tabindex="-1" aria-labelledby="comingSoonModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h5 class="modal-title" id="comingSoonModalLabel">
                        <i class="fas fa-clock"></i> Feature Coming Soon
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center py-5">
                    <div class="mb-4">
                        <i class="fas fa-hourglass-half" style="font-size: 4rem; color: #667eea;"></i>
                    </div>
                    <h4 class="mb-3" id="featureTitle">Export to Excel</h4>
                    <p class="text-muted mb-4" id="featureDescription">
                        This feature is currently under development and will be available soon.
                        We're working hard to bring you the best experience!
                    </p>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> <strong>Note:</strong> You can currently use the Print option as a temporary workaround.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
    // Chart colors
    const colors = {
        primary: '#007bff',
        success: '#28a745',
        info: '#17a2b8',
        warning: '#ffc107',
        danger: '#dc3545',
        secondary: '#6c757d'
    };

    // Monthly Revenue Chart
    const monthlyRevenueCtx = document.getElementById('monthlyRevenueChart').getContext('2d');
    new Chart(monthlyRevenueCtx, {
        type: 'bar',
        data: {
            labels: [{% for item in monthly_revenue %}'{{ item[0] }}',{% endfor %}],
            datasets: [{
                label: 'Revenue (₹)',
                data: [{% for item in monthly_revenue %}{{ item[1] }},{% endfor %}],
                backgroundColor: colors.primary,
                borderColor: colors.primary,
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return '₹' + context.parsed.y.toLocaleString('en-IN', {minimumFractionDigits: 2});
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return '₹' + value.toLocaleString('en-IN');
                        }
                    }
                }
            }
        }
    });

    // Daily Revenue Chart
    const dailyRevenueCtx = document.getElementById('dailyRevenueChart').getContext('2d');
    new Chart(dailyRevenueCtx, {
        type: 'line',
        data: {
            labels: [{% for item in daily_revenue %}'{{ item[0] }}',{% endfor %}],
            datasets: [{
                label: 'Daily Revenue (₹)',
                data: [{% for item in daily_revenue %}{{ item[1] }},{% endfor %}],
                backgroundColor: 'rgba(40, 167, 69, 0.2)',
                borderColor: colors.success,
                borderWidth: 2,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return '₹' + context.parsed.y.toLocaleString('en-IN', {minimumFractionDigits: 2});
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return '₹' + value.toLocaleString('en-IN');
                        }
                    }
                }
            }
        }
    });

    // Revenue by Type Chart
    const revenueByTypeCtx = document.getElementById('revenueByTypeChart').getContext('2d');
    new Chart(revenueByTypeCtx, {
        type: 'doughnut',
        data: {
            labels: [{% for item in revenue_by_type %}'{{ item[0] or "N/A" }}',{% endfor %}],
            datasets: [{
                data: [{% for item in revenue_by_type %}{{ item[1] }},{% endfor %}],
                backgroundColor: [colors.primary, colors.success, colors.warning, colors.info, colors.danger, colors.secondary]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.label + ': ₹' + context.parsed.toLocaleString('en-IN', {minimumFractionDigits: 2});
                        }
                    }
                }
            }
        }
    });

    // Revenue by Method Chart
    const revenueByMethodCtx = document.getElementById('revenueByMethodChart').getContext('2d');
    new Chart(revenueByMethodCtx, {
        type: 'pie',
        data: {
            labels: [{% for item in revenue_by_method %}'{{ item[0] or "N/A" }}',{% endfor %}],
            datasets: [{
                data: [{% for item in revenue_by_method %}{{ item[1] }},{% endfor %}],
                backgroundColor: [colors.info, colors.success, colors.warning, colors.primary, colors.danger]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.label + ': ₹' + context.parsed.toLocaleString('en-IN', {minimumFractionDigits: 2});
                        }
                    }
                }
            }
        }
    });

    // Revenue by District Chart
    const revenueByDistrictCtx = document.getElementById('revenueByDistrictChart').getContext('2d');
    new Chart(revenueByDistrictCtx, {
        type: 'bar',
        data: {
            labels: [{% for item in revenue_by_district %}'{{ item[0] or "N/A" }}',{% endfor %}],
            datasets: [{
                label: 'Revenue (₹)',
                data: [{% for item in revenue_by_district %}{{ item[1] }},{% endfor %}],
                backgroundColor: colors.secondary,
                borderColor: colors.secondary,
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            indexAxis: 'y',
            plugins: {
                legend: {
                    display: true
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return '₹' + context.parsed.x.toLocaleString('en-IN', {minimumFractionDigits: 2});
                        }
                    }
                }
            },
            scales: {
                x: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return '₹' + value.toLocaleString('en-IN');
                        }
                    }
                }
            }
        }
    });

    // Export functions
    function exportToExcel() {
        showComingSoonModal('Export to Excel', 'Excel export functionality is currently under development. This will allow you to download the complete revenue report with all data in .xlsx format.');
    }

    function exportToPDF() {
        showComingSoonModal('Export to PDF', 'PDF export functionality is currently under development. This will allow you to download a professionally formatted revenue report in PDF format.');
    }
    
    // Show coming soon modal
    function showComingSoonModal(title, description) {
        document.getElementById('featureTitle').textContent = title;
        document.getElementById('featureDescription').textContent = description;
        const modal = new bootstrap.Modal(document.getElementById('comingSoonModal'));
        modal.show();
    }

    // Toggle card details
    function toggleDetails(card) {
        // Prevent event propagation
        event.stopPropagation();
        
        // Toggle expanded class
        card.classList.toggle('expanded');
        
        // Optional: Add smooth scroll animation
        if (card.classList.contains('expanded')) {
            setTimeout(() => {
                card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }
    }
    
    // Toggle all properties section
    function toggleAllProperties() {
        const section = document.getElementById('allPropertiesSection');
        const btn = document.getElementById('viewAllBtn');
        
        if (section.style.display === 'none') {
            section.style.display = 'block';
            btn.innerHTML = '<i class="fas fa-chevron-up"></i> Hide Full List';
            // Smooth scroll to section
            setTimeout(() => {
                section.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        } else {
            section.style.display = 'none';
            btn.innerHTML = '<i class="fas fa-list"></i> View All {{ total_properties_count }} Properties';
        }
    }
</script>
{% endblock %}
